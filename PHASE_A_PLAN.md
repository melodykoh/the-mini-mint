# Phase A: The Engine — Ralph Loop Execution Plan

## Overview

Phase A builds the complete backend + data layer + basic admin UI. Every task is atomic, machine-verifiable, and has explicit acceptance criteria. Phase B (kid-facing UX, visual design, delight) follows interactively.

## Prerequisites (Manual, Before Ralph Loop Starts)

These must be done by Melody before autonomous execution:

- [ ] **P1: Create Supabase project** — new project in Supabase dashboard
- [ ] **P2: Get Supabase credentials** — project URL + anon key + service role key
- [ ] **P3: Get Twelve Data API key** — free registration at twelvedata.com
- [ ] **P4: Store secrets** — add to `.env.local` in repo root:
  ```
  VITE_SUPABASE_URL=...
  VITE_SUPABASE_ANON_KEY=...
  SUPABASE_SERVICE_ROLE_KEY=...
  TWELVE_DATA_API_KEY=...
  ```

---

## Task Dependency Graph

```
T1 (scaffold) ──┬── T2 (schema) ──┬── T3 (auth)
                 │                 ├── T4 (deposit/withdraw RPCs)
                 │                 ├── T5 (MMF interest RPC)
                 │                 ├── T6 (CD management RPCs)
                 │                 ├── T7 (stock position RPCs)
                 │                 └── T8 (Hanzi Dojo delta logic)
                 │                 │
                 │                 ├── T9 (Twelve Data integration) ── depends on T7
                 │                 └── T10 (investment simulator) ── depends on T5, T6
                 │
                 └── T11 (admin UI: dashboard) ── depends on T3, T4
                     T12 (admin UI: add money) ── depends on T4, T8
                     T13 (admin UI: manage investments) ── depends on T5, T6, T7
                     T14 (admin UI: record spend) ── depends on T4, T7
                     T15 (admin UI: settings) ── depends on T3
```

**Parallelizable groups:**
- After T2: T3, T4, T5, T6, T7, T8 can all run in parallel
- After T4-T8: T9, T10, T11-T15 can run in parallel

---

## Tasks

### T1: Scaffold Project

**What:** Initialize React + Vite + TypeScript + Tailwind + Supabase project with standard structure.

**Acceptance Criteria:**
- [ ] `npm run dev` starts dev server on localhost without errors
- [ ] `npm run build` produces a successful production build
- [ ] `npm run lint` passes with zero errors
- [ ] TypeScript strict mode enabled (`"strict": true` in tsconfig)
- [ ] Tailwind CSS configured and a test class renders correctly
- [ ] Supabase client initialized in `src/lib/supabase.ts`
- [ ] `.env.local` loaded (with placeholder values if secrets not yet available)
- [ ] `.gitignore` includes `.env.local`, `node_modules/`, `dist/`
- [ ] Project structure follows:
  ```
  src/
    components/    # React components
    lib/           # Supabase client, API utilities, business logic
    types/         # TypeScript interfaces
    pages/         # Page-level components (or routes/)
  supabase/
    migrations/    # SQL migration files
  ```

**Test:** `npm run dev && npm run build && npm run lint` — all three pass.

---

### T2: Create Database Schema

**What:** Write Supabase migration creating all 6 tables with RLS policies.

**Tables:** `kids`, `transactions`, `cd_lots`, `stock_positions`, `stock_prices`, `hanzi_dojo_snapshots`, `settings`

**Acceptance Criteria:**
- [ ] Migration file: `supabase/migrations/001_initial_schema.sql`
- [ ] All tables use `uuid` primary keys (generated by default)
- [ ] `transactions.type` is enum: `deposit`, `withdraw`, `invest`, `redeem`, `interest`, `buy`, `sell`
- [ ] `transactions.bucket` is enum: `cash`, `mmf`, `cd`, `stock`
- [ ] `transactions.amount` is `numeric(12,2)` — positive for inflows, negative for outflows
- [ ] `transactions.metadata` is `jsonb` (nullable)
- [ ] `cd_lots.term_months` has CHECK constraint: `term_months IN (3, 6, 12)`
- [ ] `cd_lots.status` is enum: `active`, `matured`, `broken`
- [ ] `cd_lots.maturity_date` is computed column or set by trigger: `start_date + (term_months * interval '1 month')`
- [ ] `stock_positions.shares` is `numeric(16,8)` (fractional shares need precision)
- [ ] `stock_prices` has composite PK on `(ticker, date)`
- [ ] `hanzi_dojo_snapshots` stores `total_points`, `previous_total`, `delta_points`, `dollar_equivalent`
- [ ] `settings` has `key` as PK, `value` as text, `updated_at` as timestamp
- [ ] RLS enabled on all tables
- [ ] RLS policies: authenticated users can read/write all tables (admin-only app)
- [ ] `created_at` columns default to `now()`
- [ ] All foreign keys have appropriate `ON DELETE` behavior (CASCADE for child records, RESTRICT for references)
- [ ] TypeScript types generated or manually written in `src/types/database.ts` matching all tables

**Test:** Migration runs successfully against Supabase. All tables exist. INSERT/SELECT works for each table. RLS blocks unauthenticated access.

---

### T3: Set Up Authentication

**What:** Configure Supabase email auth with two admin users.

**Acceptance Criteria:**
- [ ] `src/lib/supabase.ts` exports a configured Supabase client
- [ ] `src/lib/auth.ts` exports: `signIn(email, password)`, `signOut()`, `getCurrentUser()`, `onAuthStateChange(callback)`
- [ ] Auth context provider: `src/components/AuthProvider.tsx`
- [ ] `useAuth()` hook returns `{ user, loading, signIn, signOut }`
- [ ] Protected route wrapper: redirects to login if not authenticated
- [ ] Login page: email + password form, error display, redirects to dashboard on success
- [ ] No signup flow (admins are pre-created in Supabase dashboard)
- [ ] Auth state persists across page reloads (Supabase handles this)

**Test:**
1. Unauthenticated user sees login page
2. Wrong credentials show error message
3. Correct credentials redirect to dashboard
4. Page reload maintains auth state
5. Sign out returns to login page

---

### T4: Deposit and Withdraw RPCs

**What:** Core transaction functions for adding/removing money from cash balance.

**Functions:**
- `deposit_to_cash(kid_id, amount, note, source, created_by)` — adds a deposit transaction
- `withdraw_from_cash(kid_id, amount, note, created_by)` — adds a withdrawal transaction (validates sufficient balance)
- `get_cash_balance(kid_id)` → returns current cash balance

**Acceptance Criteria:**
- [ ] `deposit_to_cash` creates a transaction with `type='deposit'`, `bucket='cash'`, positive amount
- [ ] `deposit_to_cash` accepts `source` in metadata (e.g., `{"source": "red_envelope"}`, `{"source": "reading_reward"}`)
- [ ] `withdraw_from_cash` creates a transaction with `type='withdraw'`, `bucket='cash'`, negative amount
- [ ] `withdraw_from_cash` FAILS if amount > current cash balance (raises exception)
- [ ] `get_cash_balance` returns `SUM(t.amount) FROM transactions t WHERE t.kid_id = $1 AND t.bucket = 'cash'`
- [ ] All functions use explicit table aliases (`t.kid_id`, not `kid_id`)
- [ ] All functions are `SECURITY INVOKER` (use caller's RLS context)
- [ ] TypeScript wrapper functions in `src/lib/transactions.ts`

**Test Cases:**
```
1. Deposit $50 for Aiden → cash balance = $50.00
2. Deposit $30 for Aiden → cash balance = $80.00
3. Withdraw $20 from Aiden → cash balance = $60.00
4. Withdraw $100 from Aiden → FAILS (insufficient balance)
5. Aiden's balance unchanged after failed withdrawal = $60.00
6. Skylar's balance is $0 (independent per kid)
```

---

### T5: MMF Interest Accrual RPC

**What:** Functions for investing in MMF and accruing interest.

**Functions:**
- `invest_in_mmf(kid_id, amount, created_by)` — moves cash → MMF
- `redeem_from_mmf(kid_id, amount, created_by)` — moves MMF → cash
- `get_mmf_balance(kid_id)` → current MMF balance including accrued interest
- `accrue_mmf_interest(kid_id)` — calculates and credits daily interest since last accrual
- `accrue_all_mmf_interest()` — runs accrual for all kids (for cron job)

**Acceptance Criteria:**
- [ ] `invest_in_mmf` deducts from cash (fails if insufficient) and adds to MMF
- [ ] Creates two transactions atomically: `type='invest', bucket='cash'` (negative) + `type='invest', bucket='mmf'` (positive)
- [ ] `redeem_from_mmf` does the reverse (fails if insufficient MMF balance)
- [ ] `accrue_mmf_interest` reads current APY from `settings` table (key: `mmf_apy`)
- [ ] Interest = `mmf_balance * (apy / 365) * days_since_last_accrual`
- [ ] Interest credited as transaction: `type='interest', bucket='mmf'`
- [ ] Tracks last accrual date to avoid double-crediting
- [ ] All functions use explicit table aliases

**Test Cases:**
```
Setup: Set mmf_apy = 0.042 (4.2%)

1. Deposit $100 cash, invest $100 in MMF → cash=$0, mmf=$100
2. Accrue interest for 30 days → mmf = $100 + ($100 * 0.042/365 * 30) = $100.35 (rounded to 2 decimals)
3. Accrue again same day → no change (no double-credit)
4. Redeem $50 from MMF → cash=$50, mmf=$50.35
5. Redeem $60 from MMF → FAILS (only $50.35 available)
```

---

### T6: CD Lot Management RPCs

**What:** Functions for creating, maturing, and breaking CD lots.

**Functions:**
- `create_cd(kid_id, amount, term_months, created_by)` — locks cash into a CD lot
- `break_cd(cd_lot_id, created_by)` — early withdrawal with penalty
- `mature_cd(cd_lot_id, created_by)` — processes a matured CD (returns principal + interest to cash)
- `process_matured_cds()` — auto-processes all CDs past maturity date (for cron)
- `get_cd_lots(kid_id)` → returns all active/matured CD lots with current value

**Acceptance Criteria:**
- [ ] `create_cd` deducts from cash, creates `cd_lots` row with status='active'
- [ ] `create_cd` fails if term_months not in (3, 6, 12)
- [ ] `create_cd` fails if insufficient cash balance
- [ ] APY for each term read from settings: `cd_3m_apy`, `cd_6m_apy`, `cd_12m_apy`
- [ ] `maturity_date = start_date + (term_months * interval '1 month')`
- [ ] `mature_cd` returns principal + accrued interest to cash balance
- [ ] `mature_cd` fails if CD not yet matured (maturity_date > now)
- [ ] `mature_cd` sets status='matured'
- [ ] `break_cd` returns principal + (accrued interest - last month's interest) to cash
- [ ] `break_cd` sets status='broken'
- [ ] CD interest = `principal * apy * (actual_days / 365)`
- [ ] Penalty for early break = last 30 days of interest (or all interest if held < 30 days)
- [ ] All functions use explicit table aliases

**Test Cases:**
```
Setup: cd_3m_apy=0.048, cd_6m_apy=0.050, cd_12m_apy=0.052

1. Deposit $200 cash, create 3-month CD for $100 → cash=$100, CD lot active with $100 principal
2. Attempt to mature CD on day 1 → FAILS (not yet matured)
3. Break CD on day 45 → cash += $100 + (45 days interest) - (30 days interest penalty)
   = $100 + ($100 * 0.048 * 45/365) - ($100 * 0.048 * 30/365)
   = $100 + $0.59 - $0.39 = $100.20
   CD status = 'broken'
4. Create 6-month CD for $100, fast-forward to maturity
   → mature_cd returns $100 + ($100 * 0.050 * 182/365) = $102.49
   CD status = 'matured'
```

---

### T7: Stock Position RPCs

**What:** Functions for buying/selling virtual shares and computing position value.

**Functions:**
- `buy_stock(kid_id, ticker, dollar_amount, created_by)` — buys virtual shares at current price
- `sell_stock(kid_id, ticker, dollar_amount_or_all, created_by)` — sells virtual shares at current price
- `get_stock_positions(kid_id)` → returns all positions with current value and gain/loss
- `get_portfolio_summary(kid_id)` → returns total: cash + MMF + CD + stocks

**Acceptance Criteria:**
- [ ] `buy_stock` deducts from cash, creates/updates `stock_positions` row
- [ ] Virtual shares = dollar_amount / current_price (from latest `stock_prices` entry)
- [ ] `buy_stock` fails if insufficient cash
- [ ] `buy_stock` fails if kid already has 5 positions and this is a new ticker
- [ ] If kid already holds ticker, adds to existing position (updates shares + cost_basis)
- [ ] Creates transactions: `type='buy', bucket='cash'` (negative) + `type='buy', bucket='stock'` (positive, metadata includes ticker, shares, price)
- [ ] `sell_stock` computes dollar value at current price, reduces shares, adds cash
- [ ] If selling all shares, removes the `stock_positions` row
- [ ] `get_stock_positions` returns: ticker, shares, cost_basis, current_price, current_value, gain_loss, gain_loss_pct
- [ ] `get_portfolio_summary` returns: cash, mmf, cd_total, stock_total, grand_total
- [ ] All functions use explicit table aliases

**Test Cases:**
```
Setup: Insert stock_prices row for NVDA at $800.00

1. Deposit $500, buy $200 of NVDA → cash=$300, NVDA shares=0.25, value=$200
2. NVDA price changes to $900 → NVDA value = 0.25 * $900 = $225, gain=$25 (+12.5%)
3. Sell $100 of NVDA at $900 → sells 0.1111 shares, cash=$400, NVDA shares=0.1389, value=$125
4. Buy $100 of VTI at $250 → cash=$300, VTI shares=0.40, positions=2
5. Portfolio summary: cash=$300, mmf=$0, cd=$0, stocks=$225+$100=$325(?), total=$625
   (recalculate based on actual remaining NVDA shares * $900 + VTI shares * $250)
6. Attempt to buy 6th different ticker → FAILS (5 position limit)
```

---

### T8: Hanzi Dojo Delta Logic

**What:** High-water-mark tracking for Hanzi Dojo points → cash deposits.

**Functions:**
- `record_hanzi_dojo_points(kid_id, current_total_points, created_by)` — records snapshot, computes delta, deposits cash equivalent
- `get_hanzi_dojo_history(kid_id)` → returns all snapshots

**Acceptance Criteria:**
- [ ] First snapshot for a kid: `previous_total = 0`, delta = current_total
- [ ] Subsequent snapshots: `previous_total` = most recent snapshot's `total_points`
- [ ] `delta_points = current_total - previous_total`
- [ ] `dollar_equivalent = delta_points / 100 * 10` (i.e., $0.10 per point)
- [ ] If delta > 0: auto-creates a cash deposit transaction with note "Hanzi Dojo points" and metadata `{"source": "hanzi_dojo", "points": delta_points}`
- [ ] If delta = 0: creates snapshot but no transaction
- [ ] If delta < 0: FAILS with error (points shouldn't decrease; likely a data entry error)
- [ ] All functions use explicit table aliases

**Test Cases:**
```
1. Record 500 points for Aiden (first time) → delta=500, deposit=$50, cash=$50
2. Record 750 points → delta=250, deposit=$25, cash=$75
3. Record 750 points again → delta=0, no deposit, cash=$75
4. Record 600 points → FAILS (points decreased, likely entry error)
```

---

### T9: Twelve Data Stock Price Integration

**What:** Daily stock price fetcher using Twelve Data API.

**Acceptance Criteria:**
- [ ] `src/lib/stockPrices.ts` exports `fetchAndStorePrices(tickers: string[])`
- [ ] Uses Twelve Data batch endpoint: `GET /time_series?symbol=NVDA,VTI,...&interval=1day&outputsize=1`
- [ ] Parses response, stores each ticker's close price in `stock_prices` table
- [ ] Handles API errors gracefully (logs error, does not crash)
- [ ] Handles market holidays (no new data = no insert, no error)
- [ ] Deduplicates: if price for (ticker, date) already exists, skip or upsert
- [ ] Supabase Edge Function or cron-compatible function for daily execution
- [ ] `fetchHistoricalPrices(ticker, days)` for initial backfill (used once per new ticker)
- [ ] API key read from environment variable `TWELVE_DATA_API_KEY`

**Test Cases:**
```
1. Fetch prices for ["NVDA", "VTI", "TSM"] → 3 rows inserted in stock_prices
2. Fetch again same day → no duplicate rows (upsert behavior)
3. Invalid ticker "ZZZZZ" → graceful error handling, other tickers still processed
4. Historical backfill for NVDA (30 days) → 30 rows in stock_prices (excluding weekends/holidays)
```

---

### T10: Investment Simulator

**What:** "What would $X become?" calculator showing projected growth across products.

**Functions:**
- `simulate_growth(amount, months)` → returns projected values for each product

**Acceptance Criteria:**
- [ ] Reads current rates from `settings` table: `mmf_apy`, `cd_3m_apy`, `cd_6m_apy`, `cd_12m_apy`
- [ ] Returns projections for:
  - Cash (mattress): `amount` (no growth)
  - MMF: `amount * (1 + apy/12)^months` (monthly compounding)
  - CD 3m (if months >= 3): `amount * (1 + cd_3m_apy * 3/12)`
  - CD 6m (if months >= 6): `amount * (1 + cd_6m_apy * 6/12)`
  - CD 12m (if months >= 12): `amount * (1 + cd_12m_apy * 12/12)`
  - Stocks: returns "Unknown — that's what risk means!"
- [ ] Can be a pure TypeScript function (no RPC needed — reads settings once, computes locally)
- [ ] All amounts rounded to 2 decimal places

**Test Cases:**
```
Setup: mmf_apy=0.042, cd_3m_apy=0.048, cd_6m_apy=0.050, cd_12m_apy=0.052

simulate_growth($100, 12):
  Cash:     $100.00
  MMF:      $100 * (1 + 0.042/12)^12 = $104.28
  CD 3m:    $100 * (1 + 0.048 * 3/12) = $101.20
  CD 6m:    $100 * (1 + 0.050 * 6/12) = $102.50
  CD 12m:   $100 * (1 + 0.052) = $105.20
  Stocks:   "Unknown"

simulate_growth($50, 3):
  Cash:     $50.00
  MMF:      $50 * (1 + 0.042/12)^3 = $50.53
  CD 3m:    $50 * (1 + 0.048 * 3/12) = $50.60
  CD 6m:    N/A (term > months)
  CD 12m:   N/A (term > months)
  Stocks:   "Unknown"
```

---

### T11: Admin Dashboard Page

**What:** Landing page showing both kids' balances at a glance.

**Acceptance Criteria:**
- [ ] Route: `/` (authenticated) or `/dashboard`
- [ ] Shows one card per kid with:
  - Kid name
  - Total portfolio value (cash + MMF + CD + stocks)
  - Breakdown: cash | MMF | CD | stocks (as numbers)
- [ ] Calls `get_portfolio_summary` for each kid
- [ ] Loading state while fetching
- [ ] Error state if fetch fails
- [ ] Mobile-responsive (stacks vertically on phone)
- [ ] Navigation to individual kid detail view

**Test:** Page renders both kids' balances. Values update after a deposit is made via Add Money.

---

### T12: Add Money Page

**What:** Form for depositing money into a kid's cash balance.

**Acceptance Criteria:**
- [ ] Route: `/add-money`
- [ ] Form fields:
  - Kid selector (dropdown: Aiden / Skylar)
  - Amount (number input, required, > 0)
  - Source (dropdown: Chores, Reading Reward, Hanzi Dojo Points, Red Envelope, Gift, Other)
  - Note (optional text)
- [ ] **If source = "Hanzi Dojo Points":** show points input instead of dollar amount. App converts and displays: "750 points = $75.00". Calls `record_hanzi_dojo_points`.
- [ ] **All other sources:** dollar amount input. Calls `deposit_to_cash`.
- [ ] Success message with updated balance shown
- [ ] Form resets after successful submission (ready for next entry)
- [ ] Validation: amount must be positive, kid must be selected
- [ ] Mobile-optimized (large touch targets, easy one-handed use)

**Test:**
1. Add $50 gift for Aiden → success, balance increases by $50
2. Add 300 Hanzi Dojo points for Aiden → success, $30 deposited, balance increases by $30
3. Submit with no amount → validation error
4. Submit with negative amount → validation error

---

### T13: Manage Investments Page

**What:** Page for moving money between cash and investment products.

**Acceptance Criteria:**
- [ ] Route: `/kid/:kidId/invest`
- [ ] Shows current cash balance prominently ("Available to invest: $X")
- [ ] Three sections:

**MMF Section:**
- [ ] Current MMF balance + accrued interest shown
- [ ] "Add to MMF" form: amount input + submit
- [ ] "Withdraw from MMF" form: amount input + submit
- [ ] Shows current APY rate

**CD Section:**
- [ ] List of active CD lots: principal, APY, start date, maturity date, days remaining
- [ ] "Open New CD" form: amount + term (3/6/12 month dropdown) + submit
- [ ] Matured CDs show "Collect" button (calls `mature_cd`)
- [ ] Active CDs show "Break Early" button with penalty warning

**Stock Section:**
- [ ] List of current positions: ticker, shares, cost basis, current value, gain/loss %, current price
- [ ] "Buy Stock/ETF" form: ticker input + dollar amount + submit
- [ ] Per-position "Sell" button: amount input or "Sell All"
- [ ] Shows position count (e.g., "2 of 5 positions used")

- [ ] All actions update balances in real-time after success
- [ ] Error messages for insufficient balance, invalid ticker, etc.
- [ ] Mobile-responsive

**Test:**
1. Invest $50 in MMF → cash decreases, MMF increases
2. Open 3-month CD for $100 → cash decreases, CD appears in list
3. Buy $50 of NVDA → cash decreases, position appears with shares
4. Try to invest more than cash balance → error message

---

### T14: Record Spending Page

**What:** Form for recording when a kid spends money.

**Acceptance Criteria:**
- [ ] Route: `/spend`
- [ ] Form fields:
  - Kid selector
  - Amount (number input, required, > 0)
  - Source bucket (dropdown: Cash, MMF, Stock — with current balance shown per option)
  - If Stock: which ticker (dropdown of kid's current holdings)
  - What for (required text: "Pokemon cards", "toy", etc.)
- [ ] If source = Cash: calls `withdraw_from_cash`
- [ ] If source = MMF: calls `redeem_from_mmf` then `withdraw_from_cash`
- [ ] If source = Stock: calls `sell_stock` then `withdraw_from_cash` (two-step: liquidate then spend)
- [ ] CD is NOT an option (locked — must mature or break first via Manage Investments)
- [ ] Shows gain/loss if spending from stocks: "Selling NVDA: you gained $12!"
- [ ] Success message with new balance
- [ ] Mobile-optimized

**Test:**
1. Spend $20 from cash → cash decreases by $20
2. Spend $30 from MMF → MMF decreases, cash untouched (redeem + withdraw is atomic)
3. Spend $25 from NVDA position → shares reduced, cash untouched
4. Try to spend from CD → CD not available as option

---

### T15: Settings Page

**What:** Admin page for managing rates and app configuration.

**Acceptance Criteria:**
- [ ] Route: `/settings`
- [ ] Editable fields:
  - MMF APY (e.g., 4.2%)
  - CD 3-month APY
  - CD 6-month APY
  - CD 12-month APY
  - Stock position limit per kid (default: 5)
  - Hanzi Dojo conversion rate (default: 100 points = $10)
- [ ] Current values loaded from `settings` table
- [ ] Save button updates `settings` table
- [ ] Shows last-updated timestamp per setting
- [ ] Input validation: rates between 0% and 20%, reasonable bounds
- [ ] Mobile-responsive

**Test:**
1. Change MMF APY from 4.2% to 4.5% → saved, MMF interest accrual uses new rate
2. Set invalid rate (-5%) → validation error

---

## Seed Data

After schema is created, seed with:

```sql
-- Kids
INSERT INTO kids (name) VALUES ('Aiden'), ('Skylar');

-- Default settings
INSERT INTO settings (key, value) VALUES
  ('mmf_apy', '0.042'),
  ('cd_3m_apy', '0.048'),
  ('cd_6m_apy', '0.050'),
  ('cd_12m_apy', '0.052'),
  ('stock_position_limit', '5'),
  ('hanzi_dojo_conversion_rate', '0.10');  -- $0.10 per point
```

---

## Execution Order for Ralph Loop

**Wave 1 (sequential — foundation):**
1. T1: Scaffold project
2. T2: Create schema + seed data

**Wave 2 (parallel — all backend logic, no dependencies between them):**
3. T3: Auth
4. T4: Deposit/withdraw RPCs
5. T5: MMF interest RPCs
6. T6: CD management RPCs
7. T7: Stock position RPCs
8. T8: Hanzi Dojo delta logic

**Wave 3 (parallel — depends on Wave 2 outputs):**
9. T9: Twelve Data integration (needs T7 for stock_prices table)
10. T10: Investment simulator (needs settings from T2)

**Wave 4 (parallel — UI pages, depend on RPCs from Wave 2-3):**
11. T11: Admin dashboard
12. T12: Add money page
13. T13: Manage investments page
14. T14: Record spending page
15. T15: Settings page

**Wave 5 (integration verification):**
16. End-to-end test: deposit → invest → accrue interest → spend → verify balances

---

## Definition of Done (Phase A Complete)

- [ ] All 15 tasks pass their acceptance criteria
- [ ] All test cases pass
- [ ] `npm run build` succeeds with zero errors
- [ ] `npm run lint` passes with zero errors
- [ ] App runs on localhost, two admins can log in
- [ ] Can complete full lifecycle: add money → invest in all 3 products → accrue interest → spend
- [ ] Stock prices update from Twelve Data API
- [ ] Hanzi Dojo points convert correctly
- [ ] Investment simulator shows correct projections
- [ ] All RPCs tested in Supabase SQL Editor
- [ ] Mobile-responsive (functional, not necessarily "delightful" — that's Phase B)
